<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.5/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.5/mode-html.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.5/mode-css.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.5/mode-javascript.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.5/theme-monokai.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            900: '#2D1B69',
                            800: '#382180',
                            700: '#442799',
                            600: '#512DB3',
                            500: '#5D33CC',
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwind">
        @layer utilities {
            .scrollbar-custom::-webkit-scrollbar {
                width: 4px;
            }
            .scrollbar-custom::-webkit-scrollbar-track {
                background: #1a1a1a;
            }
            .scrollbar-custom::-webkit-scrollbar-thumb {
                background: #4a4a4a;
                border-radius: 2px;
            }
        }
    </style>
</head>
<body class="bg-black text-white h-screen">
    <div class="flex h-full">
        <!-- Left Side - Chat Interface -->
        <div class="w-1/3 border-r border-gray-800 flex flex-col">
            <div class="p-4 border-b border-gray-800">
                <h1 class="text-xl font-bold text-primary-500">Website Generator</h1>
            </div>
            
            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 scrollbar-custom">
                <!-- Messages will be inserted here -->
            </div>
            
            <!-- Input Area -->
            <div class="p-4 border-t border-gray-800">
                <form id="chat-form" class="flex gap-2">
                    <textarea 
                        id="user-input" 
                        class="flex-1 bg-gray-900 border border-gray-700 rounded-lg p-2 focus:outline-none focus:border-primary-500 resize-none"
                        placeholder="Describe your website..."
                        rows="3"
                    ></textarea>
                    <button 
                        type="submit" 
                        class="bg-primary-600 hover:bg-primary-700 px-4 py-2 rounded-lg transition-colors"
                    >
                        Generate
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Right Side - Code Editor and Preview -->
        <div class="w-2/3 flex flex-col">
            <!-- File Tabs -->
            <div class="flex border-b border-gray-800">
                <button 
                    data-file="html"
                    class="flex-1 p-4 text-center hover:bg-gray-900 border-b-2 border-primary-500 file-tab"
                >
                    HTML
                </button>
                <button 
                    data-file="css"
                    class="flex-1 p-4 text-center hover:bg-gray-900 file-tab"
                >
                    CSS
                </button>
                <button 
                    data-file="js"
                    class="flex-1 p-4 text-center hover:bg-gray-900 file-tab"
                >
                    JavaScript
                </button>
                <button 
                    data-file="preview"
                    class="flex-1 p-4 text-center hover:bg-gray-900 file-tab"
                >
                    Preview
                </button>
            </div>
            
            <!-- Editor Containers -->
            <div id="html-editor" class="flex-1 file-content"></div>
            <div id="css-editor" class="flex-1 hidden file-content"></div>
            <div id="js-editor" class="flex-1 hidden file-content"></div>
            
            <!-- Preview Container -->
            <div id="preview-container" class="hidden flex-1 bg-white">
                <iframe id="preview-frame" class="w-full h-full"></iframe>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Initialize Ace editors
        const editors = {
            html: ace.edit("html-editor"),
            css: ace.edit("css-editor"),
            js: ace.edit("js-editor")
        };

        // Configure editors
        Object.entries(editors).forEach(([type, editor]) => {
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode(`ace/mode/${type}`);
            editor.setShowPrintMargin(false);
            editor.setOptions({
                fontSize: "14px",
                enableLiveAutocompletion: true
            });
        });

        // Handle file tab switching
        document.querySelectorAll('.file-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Update tab styles
                document.querySelectorAll('.file-tab').forEach(t => {
                    t.classList.remove('border-b-2', 'border-primary-500');
                });
                tab.classList.add('border-b-2', 'border-primary-500');

                // Show/hide content
                const fileType = tab.dataset.file;
                document.querySelectorAll('.file-content, #preview-container').forEach(content => {
                    content.classList.add('hidden');
                });

                if (fileType === 'preview') {
                    document.getElementById('preview-container').classList.remove('hidden');
                    updatePreview();
                } else {
                    document.getElementById(`${fileType}-editor`).classList.remove('hidden');
                }
            });
        });

        // Function to update preview
        function updatePreview() {
            const previewFrame = document.getElementById('preview-frame');
            const combinedCode = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <style>${editors.css.getValue()}<\/style>
                </head>
                <body>
                    ${editors.html.getValue()}
                    <script>${editors.js.getValue()}<\/script>
                </body>
                </html>
            `;
            
            const blob = new Blob([combinedCode], { type: 'text/html' });
            previewFrame.src = URL.createObjectURL(blob);
        }

        // Handle form submission
        document.getElementById('chat-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();
            if (!message) return;

            // Add user message to chat
            addMessage('user', message);
            userInput.value = '';

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ prompt: message })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                // Update editors with generated code
                editors.html.setValue(data.files.html, -1);
                editors.css.setValue(data.files.css, -1);
                editors.js.setValue(data.files.js, -1);

                // Update preview
                updatePreview();

                addMessage('assistant', 'Website generated! You can view and edit the code in the editors.');

            } catch (error) {
                addMessage('error', `Error: ${error.message}`);
            }
        });

        function addMessage(type, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `mb-4 p-3 rounded-lg ${
                type === 'user' ? 'bg-primary-900 ml-8' :
                type === 'assistant' ? 'bg-gray-900 mr-8' :
                type === 'error' ? 'bg-red-900 mr-8' :
                'bg-gray-800 mr-8'
            }`;
            messageDiv.textContent = content;
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Add event listeners for real-time preview updates
        Object.values(editors).forEach(editor => {
            editor.session.on('change', () => {
                if (!document.getElementById('preview-container').classList.contains('hidden')) {
                    updatePreview();
                }
            });
        });
    </script>
</body>
</html>